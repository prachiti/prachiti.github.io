<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momentum - Job Search Companion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            padding: 0;
        }
        
        .container {
            max-width: 100%;
            margin: 0;
            background: white;
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
        }
        
        .header {
            background: white;
            color: #333;
            padding: 20px 30px;
            text-align: center;
            position: relative;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .header h1 {
            font-size: 1.6em;
            margin-bottom: 5px;
            color: #333;
        }
        
        .header p {
            opacity: 0.7;
            font-size: 0.95em;
            color: #666;
        }
        
        .user-badge {
            position: absolute;
            top: 20px;
            right: 30px;
            background: #f0f0f0;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #333;
        }
        
        .logout-btn {
            background: #e0e0e0;
            border: none;
            color: #333;
            padding: 4px 12px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.85em;
            margin-left: 10px;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: #d0d0d0;
        }
        
        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .login-box {
            background: white;
            padding: 50px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            max-width: 400px;
            width: 100%;
            text-align: center;
            border: 1px solid #e0e0e0;
        }
        
        .login-box h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .login-box p {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .login-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.1em;
            margin-bottom: 20px;
            transition: border-color 0.3s;
        }
        
        .login-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .login-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .login-button:hover {
            transform: translateY(-2px);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            padding: 15px 30px;
            background: #f8f9fa;
        }
        
        .stat-card {
            background: white;
            padding: 12px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 3px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.8em;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e0e0e0;
            padding: 0 30px;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1em;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab:hover {
            color: #667eea;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: 600;
        }
        
        .content {
            padding: 20px 30px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .add-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: transform 0.2s;
        }
        
        .add-button:hover {
            transform: translateY(-2px);
        }
        
        /* Statistics Dashboard */
        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Search and Filter */
        .search-filter-container {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .search-input {
            flex: 1;
            min-width: 200px;
            padding: 10px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95em;
            transition: all 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .filter-select {
            padding: 10px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95em;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 150px;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        /* Template Buttons */
        .template-btn {
            padding: 8px 16px;
            background: white;
            border: 2px solid #ffc107;
            color: #856404;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85em;
            transition: all 0.3s;
        }
        
        .template-btn:hover {
            background: #ffc107;
            color: white;
            transform: translateY(-2px);
        }
        
        /* Timeline View */
        .timeline-view {
            position: relative;
        }
        
        .timeline-item {
            display: flex;
            margin-bottom: 20px;
            position: relative;
            padding-left: 40px;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 12px;
            top: 5px;
            width: 12px;
            height: 12px;
            background: #667eea;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #667eea;
        }
        
        .timeline-item::after {
            content: '';
            position: absolute;
            left: 17px;
            top: 20px;
            width: 2px;
            height: calc(100% + 20px);
            background: #e0e0e0;
        }
        
        .timeline-item:last-child::after {
            display: none;
        }
        
        .timeline-content {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            flex: 1;
        }
        
        .timeline-date {
            font-weight: 600;
            color: #667eea;
            font-size: 0.9em;
        }
        
        .timeline-title {
            color: #333;
            margin: 5px 0;
            font-weight: 600;
        }
        
        .timeline-desc {
            color: #666;
            font-size: 0.9em;
        }
        
        /* Resume Management */
        .resume-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .resume-info {
            flex: 1;
        }
        
        .resume-name {
            font-weight: 600;
            color: #333;
        }
        
        .resume-date {
            color: #999;
            font-size: 0.85em;
        }
        
        .resume-actions {
            display: flex;
            gap: 10px;
        }
        
        .resume-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .resume-download {
            background: #4caf50;
            color: white;
        }
        
        .resume-download:hover {
            opacity: 0.9;
        }
        
        .resume-delete {
            background: #f44336;
            color: white;
        }
        
        .resume-delete:hover {
            opacity: 0.9;
        }
        
        /* Rich Text Editor */
        .rich-editor {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            min-height: 200px;
        }
        
        .editor-toolbar {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }
        
        .editor-btn {
            padding: 6px 10px;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.2s;
        }
        
        .editor-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .editor-content {
            min-height: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow-y: auto;
            max-height: 300px;
        }
        
        .job-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        
        .job-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }
        
        .job-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }
        
        .job-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .job-company {
            color: #667eea;
            font-size: 1.1em;
            font-weight: 600;
        }
        
        .job-status {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .status-applied { background: #e3f2fd; color: #1976d2; }
        .status-interview { background: #fff3e0; color: #f57c00; }
        .status-offer { background: #e8f5e9; color: #388e3c; }
        .status-rejected { background: #ffebee; color: #d32f2f; }
        .status-waiting { background: #f3e5f5; color: #7b1fa2; }
        
        .job-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            color: #666;
            font-size: 0.95em;
        }
        
        .detail-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .detail-label {
            font-weight: 600;
            color: #333;
        }
        
        .job-notes {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            color: #666;
            font-size: 0.95em;
            line-height: 1.6;
        }
        
        .action-buttons {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
        }
        
        .btn-update {
            background: #667eea;
            color: white;
        }
        
        .btn-delete {
            background: #f44336;
            color: white;
        }
        
        .btn:hover {
            opacity: 0.8;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s;
        }
        
        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }
        
        .btn-primary {
            flex: 1;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            cursor: pointer;
            font-weight: 600;
        }
        
        .btn-secondary {
            padding: 12px 25px;
            background: #e0e0e0;
            color: #333;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            cursor: pointer;
        }
        
        .urgent-banner {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        
        .urgent-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 8px;
        }
        
        .urgent-list {
            list-style: none;
            color: #856404;
        }
        
        .urgent-list li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .urgent-list li:before {
            content: "‚ö†Ô∏è";
            position: absolute;
            left: 0;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        
        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.2em;
        }
        
        @media (max-width: 768px) {
            .stats {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                overflow-x: auto;
            }
            
            .job-details {
                grid-template-columns: 1fr;
            }
            
            .user-badge {
                position: static;
                margin-top: 10px;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <h1>üéØ</h1>
            <h1>Momentum</h1>
            <p>Pick a username to get started</p>
            <input type="text" id="usernameInput" class="login-input" placeholder="Your username" maxlength="20">
            <button onclick="login()" class="login-button">Start Tracking</button>
        </div>
    </div>

    <div id="appContainer" class="container" style="display: none;">
        <div class="header">
            <div class="user-badge">
                üë§ <span id="currentUser"></span>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
            <h1>üöÄ Momentum - Keep Moving Forward</h1>
            <p>Stay organized. Stay motivated. Land that dream role.</p>
        </div>
        
        <div class="stats">
            <div class="stat-card" onclick="showMetricDetails('total')" style="cursor: pointer;">
                <div class="stat-number" id="totalApps">0</div>
                <div class="stat-label">Total Applications</div>
                <div style="font-size: 0.75em; color: #999; margin-top: 5px;">üëÜ Click to view details</div>
            </div>
            <div class="stat-card" onclick="showMetricDetails('active')" style="cursor: pointer;">
                <div class="stat-number" id="activeCount">0</div>
                <div class="stat-label">Active Pipeline</div>
                <div style="font-size: 0.75em; color: #999; margin-top: 5px;">üëÜ Click to view details</div>
            </div>
            <div class="stat-card" onclick="showMetricDetails('interviews')" style="cursor: pointer;">
                <div class="stat-number" id="interviewCount">0</div>
                <div class="stat-label">Interviews</div>
                <div style="font-size: 0.75em; color: #999; margin-top: 5px;">üëÜ Click to view details</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="responseRate">0%</div>
                <div class="stat-label">Response Rate</div>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('pipeline')">üìã Pipeline</button>
            <button class="tab" onclick="switchTab('interviews')">üé§ Interviews</button>
            <button class="tab" onclick="switchTab('prep')">üìÑ Prep Materials</button>
            <button class="tab" onclick="switchTab('todo')">‚úÖ To-Do</button>
            <button class="tab" onclick="switchTab('targets')">üéØ Targets</button>
            <button class="tab" onclick="switchTab('calendar')">üìÖ Calendar</button>
            <button class="tab" onclick="switchTab('resumes')">üìã Resumes</button>
            <button class="tab" onclick="switchTab('import')">üìä Bulk Import</button>
            <button class="tab" onclick="switchTab('sync')">‚òÅÔ∏è Sync</button>
        </div>
        
        <div class="content">
            <div id="pipeline" class="tab-content active">
                <button class="add-button" onclick="openAddJobModal()">+ Add Application</button>
                
                <!-- Statistics Dashboard -->
                <div class="stats-dashboard">
                    <div class="stat-card">
                        <div class="stat-value" id="statTotal">0</div>
                        <div class="stat-label">Total Applications</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statApplied">0</div>
                        <div class="stat-label">Applied</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statReview">0</div>
                        <div class="stat-label">In Review</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statInterviews">0</div>
                        <div class="stat-label">Interviews</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statOffers">0</div>
                        <div class="stat-label">Offers</div>
                    </div>
                </div>
                
                <!-- Search and Filter -->
                <div class="search-filter-container">
                    <input type="text" id="jobSearch" placeholder="Search by company, role, or location..." 
                           onkeyup="renderJobs()" class="search-input">
                    <select id="statusFilter" onchange="renderJobs()" class="filter-select">
                        <option value="all">All Statuses</option>
                        <option value="applied">Applied</option>
                        <option value="in review">In Review</option>
                        <option value="interview">Interview</option>
                        <option value="offer">Offer</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                
                <div id="urgentBanner" class="urgent-banner">
                    <div class="urgent-title">üî• Keep Your Momentum:</div>
                    <ul class="urgent-list" id="urgentTodosList">
                        <li>Loading urgent tasks...</li>
                    </ul>
                </div>
                
                <div id="jobsList" class="loading">Loading your applications...</div>
            </div>
            
            <div id="interviews" class="tab-content">
                <button class="add-button" onclick="openAddInterviewModal()">+ Add Interview</button>
                <div id="interviewsList" class="loading">Loading your interviews...</div>
            </div>
            
            <div id="prep" class="tab-content">
                <button class="add-button" onclick="openAddPrepModal()">+ Add Prep Material</button>
                
                <!-- Quick Templates Section -->
                <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px 20px; margin-bottom: 20px; border-radius: 8px;">
                    <div style="font-weight: bold; color: #856404; margin-bottom: 10px;">üìö Quick Templates:</div>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button class="template-btn" onclick="addPrepTemplate('STAR Story Template')">STAR Stories</button>
                        <button class="template-btn" onclick="addPrepTemplate('System Design Prep')">System Design</button>
                        <button class="template-btn" onclick="addPrepTemplate('Product Case Study')">Product Cases</button>
                        <button class="template-btn" onclick="addPrepTemplate('Behavioral Questions')">Behavioral Q&A</button>
                        <button class="template-btn" onclick="addPrepTemplate('Cover Letter Template')">Cover Letter</button>
                        <button class="template-btn" onclick="addPrepTemplate('Research Checklist')">Company Research</button>
                    </div>
                </div>
                
                <div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 15px 20px; margin-bottom: 20px; border-radius: 8px;">
                    <div style="font-weight: bold; color: #1565c0; margin-bottom: 8px;">üí° Two ways to store materials:</div>
                    <div style="color: #1565c0; font-size: 0.95em;">
                        <strong>‚òÅÔ∏è Google Drive:</strong> Upload formatted docs to Drive, paste link here for instant access<br>
                        <strong>üìù Quick Notes:</strong> Store text directly for reference (cover letter templates, STAR stories, prep notes)
                    </div>
                </div>
                <div id="prepList" class="loading">Loading your prep materials...</div>
            </div>
            
            <div id="todo" class="tab-content">
                <button class="add-button" onclick="openAddTodoModal()">+ Add To-Do</button>
                <div id="todoList" class="loading">Loading your to-dos...</div>
            </div>
            
            <div id="targets" class="tab-content">
                <button class="add-button" onclick="openAddTargetModal()">+ Add Target Company</button>
                <div id="targetsList" class="loading">Loading target companies...</div>
            </div>
            
            <div id="calendar" class="tab-content">
                <div style="background: #e8f5e9; border-left: 4px solid #4caf50; padding: 15px 20px; margin-bottom: 20px; border-radius: 8px;">
                    <div style="font-weight: bold; color: #2e7d32; margin-bottom: 8px;">üìÖ Timeline View</div>
                    <div style="color: #2e7d32; font-size: 0.95em;">
                        All your applications and interviews organized by date.
                    </div>
                </div>
                <div id="timelineView" class="timeline-view"></div>
            </div>
            
            <div id="resumes" class="tab-content">
                <button class="add-button" onclick="openResumeUploadModal()">+ Upload Resume/CV</button>
                <div style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 15px 20px; margin-bottom: 20px; border-radius: 8px;">
                    <div style="font-weight: bold; color: #e65100; margin-bottom: 8px;">üìÑ Resume Management</div>
                    <div style="color: #e65100; font-size: 0.95em;">Store different resume versions for specific companies.</div>
                </div>
                <div id="resumesList" class="loading">Loading resumes...</div>
            </div>
            
            <div id="import" class="tab-content">
                <div style="background: #f3e5f5; border-left: 4px solid #9c27b0; padding: 15px 20px; margin-bottom: 20px; border-radius: 8px;">
                    <div style="font-weight: bold; color: #6a1b9a; margin-bottom: 8px;">üìä Bulk Import</div>
                    <div style="color: #6a1b9a; font-size: 0.95em;">Import jobs from CSV.</div>
                </div>
                <div style="background: white; border: 2px solid #9c27b0; border-radius: 12px; padding: 25px; margin-bottom: 20px;">
                    <h3 style="color: #9c27b0; margin-bottom: 15px;">üì• Import from CSV</h3>
                    <p style="color: #666; margin-bottom: 15px; font-size: 0.9em;">Download template, fill with your data, upload here.</p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="downloadCSVTemplate()" style="padding: 12px 24px; background: #9c27b0; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">‚¨áÔ∏è Download Template</button>
                        <button onclick="document.getElementById('csvFile').click()" style="padding: 12px 24px; background: #fff; color: #9c27b0; border: 2px solid #9c27b0; border-radius: 8px; cursor: pointer; font-weight: 600;">üì§ Upload CSV</button>
                        <input type="file" id="csvFile" style="display: none;" accept=".csv" onchange="importCSV(event)">
                    </div>
                </div>
            </div>
            
            <div id="sync" class="tab-content">
                <h2 style="margin-bottom: 20px; color: #333;">‚òÅÔ∏è Backup & Sync Your Data</h2>
                
                <!-- Google Drive Sync Section -->
                <div style="background: #e8f5e9; border-left: 4px solid #4caf50; padding: 20px; margin-bottom: 30px; border-radius: 8px;">
                    <div style="font-weight: bold; color: #2e7d32; margin-bottom: 10px;">üîê Google Drive Sync (Optional)</div>
                    <p style="color: #2e7d32; margin-bottom: 15px; font-size: 0.95em;">Sign in with Google to enable automatic cloud sync. Your data stays in YOUR Google Drive.</p>
                    <div id="googleSignInContainer" style="margin-bottom: 15px;"></div>
                    <div id="userEmail" style="display: none; margin-bottom: 15px; font-weight: 600; color: #2e7d32;"></div>
                    <div id="syncStatusText" style="margin-bottom: 15px; padding: 10px; background: #fff; border-radius: 6px; border-left: 3px solid #4caf50; color: #2e7d32;">Ready to sync</div>
                    <button onclick="manualSync()" style="width: 100%; padding: 12px; background: #4caf50; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; margin-bottom: 10px;">üîÑ Sync Now</button>
                </div>
                
                <div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 20px; margin-bottom: 30px; border-radius: 8px;">
                    <div style="font-weight: bold; color: #1565c0; margin-bottom: 10px;">üí° How it works:</div>
                    <div style="color: #1565c0; font-size: 0.95em; line-height: 1.6;">
                        <strong>Export:</strong> Download your data as CSV files ‚Üí Upload to Google Sheets ‚Üí Edit and organize<br>
                        <strong>Import:</strong> Download CSV from Google Sheets ‚Üí Upload here ‚Üí Data synced!<br>
                        <strong>Backup:</strong> Export JSON file ‚Üí Save to Google Drive ‚Üí Full backup of everything
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: white; border: 2px solid #4caf50; border-radius: 12px; padding: 25px;">
                        <h3 style="color: #4caf50; margin-bottom: 15px;">üì• Export to Google Sheets</h3>
                        <p style="color: #666; margin-bottom: 20px; font-size: 0.95em;">Download CSV files to upload to Google Sheets. You can then view, edit, and share your data.</p>
                        <button onclick="exportToCSV()" style="width: 100%; padding: 12px; background: #4caf50; color: white; border: none; border-radius: 8px; font-size: 1em; cursor: pointer; font-weight: 600;">
                            üì• Export All Data (CSV)
                        </button>
                    </div>
                    
                    <div style="background: white; border: 2px solid #2196f3; border-radius: 12px; padding: 25px;">
                        <h3 style="color: #2196f3; margin-bottom: 15px;">üì§ Import from Google Sheets</h3>
                        <p style="color: #666; margin-bottom: 20px; font-size: 0.95em;">Upload CSV files from Google Sheets to sync your data back to the tracker.</p>
                        <input type="file" id="importFile" accept=".csv,.json" style="display: none;" onchange="handleImport(event)">
                        <button onclick="document.getElementById('importFile').click()" style="width: 100%; padding: 12px; background: #2196f3; color: white; border: none; border-radius: 8px; font-size: 1em; cursor: pointer; font-weight: 600;">
                            üì§ Import Data (CSV/JSON)
                        </button>
                    </div>
                    
                    <div style="background: white; border: 2px solid #ff9800; border-radius: 12px; padding: 25px;">
                        <h3 style="color: #ff9800; margin-bottom: 15px;">üíæ Full Backup</h3>
                        <p style="color: #666; margin-bottom: 20px; font-size: 0.95em;">Export complete backup as JSON. Save to Google Drive for safekeeping.</p>
                        <button onclick="exportBackup()" style="width: 100%; padding: 12px; background: #ff9800; color: white; border: none; border-radius: 8px; font-size: 1em; cursor: pointer; font-weight: 600;">
                            üíæ Download Backup (JSON)
                        </button>
                    </div>
                </div>
                
                <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="font-weight: bold; color: #856404; margin-bottom: 10px;">üìù How to use with Google Sheets:</div>
                    <ol style="color: #856404; margin-left: 20px; line-height: 1.8;">
                        <li>Click "Export All Data (CSV)" - Downloads 5 CSV files</li>
                        <li>Go to Google Sheets ‚Üí Create new spreadsheet</li>
                        <li>Import each CSV: File ‚Üí Import ‚Üí Upload ‚Üí Replace spreadsheet</li>
                        <li>Create separate sheets for: Applications, Interviews, To-Dos, Targets, Prep Materials</li>
                        <li>Edit in Google Sheets as needed</li>
                        <li>When ready to sync back: File ‚Üí Download ‚Üí CSV</li>
                        <li>Click "Import Data" here and upload the CSV</li>
                    </ol>
                </div>
                
                <div style="background: #f3e5f5; border-left: 4px solid #9c27b0; padding: 20px; border-radius: 8px;">
                    <div style="font-weight: bold; color: #6a1b9a; margin-bottom: 10px;">‚ö° Pro Tips:</div>
                    <ul style="color: #6a1b9a; margin-left: 20px; line-height: 1.8;">
                        <li><strong>Regular backups:</strong> Export to JSON weekly, save to Google Drive</li>
                        <li><strong>Cross-device:</strong> Export on laptop, import on phone</li>
                        <li><strong>Collaboration:</strong> Share Google Sheet with coach/mentor</li>
                        <li><strong>Analysis:</strong> Use Google Sheets charts to visualize your progress</li>
                        <li><strong>Version control:</strong> Keep dated backups (e.g., "job-tracker-2026-02-12.json")</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Job Modal -->
    <div id="addJobModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Add New Application</div>
            <form id="addJobForm" onsubmit="addJob(event)">
                <div class="form-group">
                    <label class="form-label">Company *</label>
                    <input type="text" class="form-input" id="jobCompany" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Role *</label>
                    <input type="text" class="form-input" id="jobRole" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Status *</label>
                    <select class="form-select" id="jobStatus" required>
                        <option value="applied">Applied</option>
                        <option value="waiting">Waiting for Response</option>
                        <option value="interview">Interview Scheduled</option>
                        <option value="offer">Offer</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Applied Date</label>
                    <input type="date" class="form-input" id="jobDate" value="">
                    <div style="font-size: 0.85em; color: #666; margin-top: 5px;">üí° Leave blank to use today's date</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Salary Range</label>
                    <input type="text" class="form-input" id="jobSalary" placeholder="e.g., $180K-230K">
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input type="text" class="form-input" id="jobLocation" placeholder="e.g., Remote, Bay Area">
                </div>
                <div class="form-group">
                    <label class="form-label">Job Posting URL</label>
                    <input type="text" class="form-input" id="jobUrl" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-textarea" id="jobNotes" placeholder="Why this is a good fit, what to emphasize, etc."></textarea>
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="btn-primary">Add Application</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('addJobModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Job Modal -->
    <div id="editJobModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Edit Application</div>
            <form id="editJobForm" onsubmit="saveEditJob(event)">
                <input type="hidden" id="editJobId">
                <div class="form-group">
                    <label class="form-label">Company *</label>
                    <input type="text" class="form-input" id="editJobCompany" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Role *</label>
                    <input type="text" class="form-input" id="editJobRole" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Status *</label>
                    <select class="form-select" id="editJobStatus" required>
                        <option value="applied">Applied</option>
                        <option value="waiting">Waiting for Response</option>
                        <option value="interview">Interview Scheduled</option>
                        <option value="offer">Offer</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Applied Date</label>
                    <input type="date" class="form-input" id="editJobDate">
                </div>
                <div class="form-group">
                    <label class="form-label">Salary Range</label>
                    <input type="text" class="form-input" id="editJobSalary" placeholder="e.g., $180K-230K">
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input type="text" class="form-input" id="editJobLocation" placeholder="e.g., Remote, Bay Area">
                </div>
                <div class="form-group">
                    <label class="form-label">Job Posting URL</label>
                    <input type="text" class="form-input" id="editJobUrl" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-textarea" id="editJobNotes" placeholder="Why this is a good fit, what to emphasize, etc."></textarea>
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="btn-primary">Save Changes</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('editJobModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Metric Details Modal -->
    <div id="metricDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header" id="metricDetailsTitle">Details</div>
            <div id="metricDetailsContent"></div>
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="closeModal('metricDetailsModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Add Interview Modal -->
    <div id="addInterviewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Add Interview</div>
            <form id="addInterviewForm" onsubmit="addInterview(event)">
                <div class="form-group">
                    <label class="form-label">Link to Application</label>
                    <select class="form-select" id="interviewJobId">
                        <option value="">Select an application (optional)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Company *</label>
                    <input type="text" class="form-input" id="interviewCompany" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Interview Stage *</label>
                    <input type="text" class="form-input" id="interviewStage" placeholder="e.g., Recruiter Screen, Hiring Manager" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Interviewer Name(s)</label>
                    <input type="text" class="form-input" id="interviewInterviewer" placeholder="e.g., Jane Smith, Product Lead">
                </div>
                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input type="date" class="form-input" id="interviewDate">
                </div>
                <div class="form-group">
                    <label class="form-label">Duration (minutes)</label>
                    <input type="number" class="form-input" id="interviewDuration" placeholder="e.g., 60">
                </div>
                <div class="form-group">
                    <label class="form-label">Outcome</label>
                    <select class="form-select" id="interviewOutcome">
                        <option value="Scheduled">Scheduled</option>
                        <option value="Passed">Passed</option>
                        <option value="Rejected">Rejected</option>
                        <option value="Pending">Pending</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Questions Asked</label>
                    <textarea class="form-textarea" id="interviewQuestions" placeholder="List the questions they asked you..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Your Answers / Performance</label>
                    <textarea class="form-textarea" id="interviewAnswers" placeholder="How did you answer? What went well? What could improve?"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Questions You Asked</label>
                    <textarea class="form-textarea" id="interviewYourQuestions" placeholder="What questions did you ask them?"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Overall Notes & Lessons Learned</label>
                    <textarea class="form-textarea" id="interviewNotes" placeholder="Key takeaways, red flags, next steps, areas to improve..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Follow-up Actions</label>
                    <textarea class="form-textarea" id="interviewFollowup" placeholder="What do you need to do next? Send thank you? Prepare for next round?"></textarea>
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="btn-primary">Add Interview</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('addInterviewModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Todo Modal -->
    <div id="addTodoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Add To-Do</div>
            <form id="addTodoForm" onsubmit="addTodo(event)">
                <div class="form-group">
                    <label class="form-label">Task *</label>
                    <input type="text" class="form-input" id="todoText" required>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="todoUrgent" style="width: auto; margin-right: 8px;">
                        Mark as urgent
                    </label>
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="btn-primary">Add To-Do</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('addTodoModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Target Modal -->
    <div id="addTargetModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Add Target Company</div>
            <form id="addTargetForm" onsubmit="addTarget(event)">
                <div class="form-group">
                    <label class="form-label">Company *</label>
                    <input type="text" class="form-input" id="targetCompany" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Role *</label>
                    <input type="text" class="form-input" id="targetRole" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Priority</label>
                    <select class="form-select" id="targetPriority">
                        <option value="HIGH">HIGH</option>
                        <option value="MEDIUM">MEDIUM</option>
                        <option value="LOW">LOW</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Why Good Fit?</label>
                    <textarea class="form-textarea" id="targetWhy" placeholder="Why is this a good opportunity for you?"></textarea>
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="btn-primary">Add Target</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('addTargetModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Prep Material Modal -->
    <div id="addPrepModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Add Prep Material</div>
            <form id="addPrepForm" onsubmit="addPrep(event)">
                <div class="form-group">
                    <label class="form-label">Title *</label>
                    <input type="text" class="form-input" id="prepTitle" placeholder="e.g., Master Resume, NextRoll Cover Letter, STAR Stories" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Type</label>
                    <select class="form-select" id="prepType">
                        <option value="Resume">Resume</option>
                        <option value="Cover Letter">Cover Letter</option>
                        <option value="Interview Prep">Interview Prep</option>
                        <option value="Research Notes">Research Notes</option>
                        <option value="STAR Stories">STAR Stories</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Company (Optional)</label>
                    <input type="text" class="form-input" id="prepCompany" placeholder="Leave blank for general materials">
                </div>
                <div class="form-group">
                    <label class="form-label">Google Drive Link (Optional)</label>
                    <input type="text" class="form-input" id="prepDriveLink" placeholder="https://docs.google.com/...">
                    <div style="font-size: 0.85em; color: #666; margin-top: 5px;">üí° Upload to Google Drive, get shareable link, paste here</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Quick Notes</label>
                    <textarea class="form-textarea" id="prepContent" placeholder="Quick reference notes, key points, or full text if no Drive link" style="min-height: 150px;"></textarea>
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="btn-primary">Save Material</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('addPrepModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View/Edit Prep Material Modal -->
    <div id="viewPrepModal" class="modal">
        <div class="modal-content">
            <div class="modal-header" id="viewPrepTitle">Prep Material</div>
            <div class="form-group">
                <label class="form-label">Content</label>
                <textarea class="form-textarea" id="viewPrepContent" readonly style="min-height: 300px; background: #f8f9fa;"></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn-primary" onclick="copyPrepContent()">üìã Copy to Clipboard</button>
                <button class="btn-secondary" onclick="closeModal('viewPrepModal')">Close</button>
            </div>
        </div>
    </div>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://www.gstatic.com/client?onload=onGapiLoad&async=true"></script>
    <script>
        // ===== GOOGLE DRIVE SYNC =====
        const GOOGLE_CLIENT_ID = '1063975145667-okf0c2dgda4a0bfmlm9tlianr564ugm2.apps.googleusercontent.com'; // Replace with your Client ID
        let googleAuth = null;
        let googleAccessToken = null;
        let spreadsheetId = null;
        let syncInterval = null;
        
        function onGapiLoad() {
            gapi.load('client:auth2', initGoogleAPI);
        }
        
        function initGoogleAPI() {
            gapi.client.init({
                clientId: GOOGLE_CLIENT_ID,
                scope: 'https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/spreadsheets',
                discoveryDocs: [
                    'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest',
                    'https://www.googleapis.com/discovery/v1/apis/sheets/v4/rest'
                ]
            }).then(() => {
                console.log('‚úÖ Google API initialized');
                setupGoogleSignIn();
            }, error => {
                console.error('‚ùå Error initializing Google API:', error);
            });
        }
        
        function setupGoogleSignIn() {
            google.accounts.id.initialize({
                client_id: GOOGLE_CLIENT_ID,
                callback: handleCredentialResponse
            });
            
            if (document.getElementById('googleSignInButton')) {
                google.accounts.id.renderButton(
                    document.getElementById('googleSignInButton'),
                    { theme: 'outline', size: 'large', text: 'signin_with' }
                );
            }
        }
        
        function handleCredentialResponse(response) {
            googleAccessToken = response.credential;
            const payload = JSON.parse(atob(response.credential.split('.')[1]));
            console.log('‚úÖ Signed in as:', payload.email);
            
            if (document.getElementById('googleSignInButton')) {
                document.getElementById('googleSignInButton').style.display = 'none';
            }
            if (document.getElementById('userEmail')) {
                document.getElementById('userEmail').textContent = payload.email;
                document.getElementById('userEmail').style.display = 'block';
            }
            
            initializeSync();
        }
        
        function initializeSync() {
            findOrCreateSpreadsheet().then(() => {
                loadFromGoogleSheets();
                syncInterval = setInterval(() => { syncBothWays(); }, 30000);
                window.addEventListener('online', syncBothWays);
            });
        }
        
        async function findOrCreateSpreadsheet() {
            try {
                const response = await gapi.client.drive.files.list({
                    q: "name='Momentum Data' and mimeType='application/vnd.google-apps.spreadsheet' and trashed=false",
                    spaces: 'drive',
                    fields: 'files(id, name)',
                    pageSize: 1
                });
                
                if (response.result.files.length > 0) {
                    spreadsheetId = response.result.files[0].id;
                    console.log('‚úÖ Found existing spreadsheet:', spreadsheetId);
                } else {
                    await createNewSpreadsheet();
                }
            } catch (error) {
                console.error('‚ùå Error finding spreadsheet:', error);
            }
        }
        
        async function createNewSpreadsheet() {
            try {
                const resource = {
                    properties: { title: 'Momentum Data' },
                    sheets: [
                        { properties: { title: 'Applications' } },
                        { properties: { title: 'Interviews' } },
                        { properties: { title: 'Todos' } },
                        { properties: { title: 'Targets' } },
                        { properties: { title: 'Prep Materials' } }
                    ]
                };
                
                const response = await gapi.client.sheets.spreadsheets.create({
                    resource: resource,
                    fields: 'spreadsheetId'
                });
                
                spreadsheetId = response.result.spreadsheetId;
                console.log('‚úÖ Created new spreadsheet:', spreadsheetId);
            } catch (error) {
                console.error('‚ùå Error creating spreadsheet:', error);
            }
        }
        
        async function loadFromGoogleSheets() {
            if (!spreadsheetId) return;
            
            try {
                const response = await gapi.client.sheets.spreadsheets.values.batchGet({
                    spreadsheetId: spreadsheetId,
                    ranges: ['Applications!A:H', 'Interviews!A:H', 'Todos!A:F', 'Targets!A:E', 'Prep Materials!A:E']
                });
                
                if (response.result.valueRanges[0].values) {
                    jobs = [];
                    const appRows = response.result.valueRanges[0].values.slice(1);
                    appRows.forEach(row => {
                        jobs.push({
                            id: parseInt(row[0]) || Date.now(),
                            company: row[1] || '',
                            role: row[2] || '',
                            status: row[3] || 'applied',
                            location: row[4] || '',
                            salary: row[5] || '',
                            date: row[6] || '',
                            notes: row[7] || ''
                        });
                    });
                }
                
                renderAll();
                showSyncStatus('‚úÖ Synced');
            } catch (error) {
                console.error('‚ùå Error loading from Sheets:', error);
                showSyncStatus('‚ö†Ô∏è Sync failed');
            }
        }
        
        async function saveToGoogleSheets() {
            if (!spreadsheetId) return;
            
            try {
                const appValues = [['ID', 'Company', 'Role', 'Status', 'Location', 'Salary', 'Date', 'Notes']];
                jobs.forEach(job => {
                    appValues.push([job.id, job.company, job.role, job.status, job.location, job.salary, job.date, job.notes]);
                });
                
                const requests = [{
                    range: 'Applications!A:H',
                    values: appValues
                }];
                
                await gapi.client.sheets.spreadsheets.values.batchUpdate({
                    spreadsheetId: spreadsheetId,
                    resource: { data: requests, valueInputOption: 'RAW' }
                });
                
                console.log('‚úÖ Data saved to Sheets');
                showSyncStatus('‚úÖ Synced');
            } catch (error) {
                console.error('‚ùå Error saving to Sheets:', error);
                showSyncStatus('‚ùå Sync failed');
            }
        }
        
        async function syncBothWays() {
            if (!navigator.onLine) {
                showSyncStatus('‚ö†Ô∏è Offline');
                return;
            }
            
            showSyncStatus('üîÑ Syncing...');
            try {
                await loadFromGoogleSheets();
                await saveToGoogleSheets();
                showSyncStatus('‚úÖ Synced');
            } catch (error) {
                console.error('‚ùå Sync error:', error);
                showSyncStatus('‚ùå Sync error');
            }
        }
        
        function showSyncStatus(message) {
            const statusElement = document.getElementById('syncStatusText');
            if (statusElement) {
                statusElement.textContent = message;
            }
        }
        
        function manualSync() {
            syncBothWays();
        }
        
        window.addEventListener('offline', () => {
            showSyncStatus('‚ö†Ô∏è Offline');
        });
        
        window.addEventListener('online', () => {
            syncBothWays();
        });
    </script>

    <script>
        let currentUsername = null;
        let jobs = [];
        let interviews = [];
        let todos = [];
        let targets = [];
        let prepMaterials = [];
        
        // Initial data for Prachiti (will only show for her username)
        const initialData = {
            jobs: [
                {
                    id: 1704067200000,
                    company: 'StackAdapt',
                    role: 'Campaign Management Specialist',
                    status: 'rejected',
                    date: '2025-12-25',
                    salary: '$180K+',
                    location: 'Remote',
                    url: '',
                    notes: 'Applied Christmas Day - strong fit for DSP experience. REJECTED - Closed.',
                    todos: []
                },
                {
                    id: 1707624000000,
                    company: 'NextRoll',
                    role: 'Sr/Product Manager, Connected TV (CTV)',
                    status: 'interview',
                    date: '2026-02-10',
                    salary: '$125K-232K',
                    location: 'Remote/SF/NYC',
                    url: '',
                    notes: 'Recruiter screen completed 2/11/26. Thank you email sent 2/12/26. Waiting for hiring manager interview (expect by 2/20). Perfect fit - building CTV DSP platform, B2C+B2B focus. Key talking points: $57M CTV DSP build, cross-functional leadership, measurement expertise.',
                    todos: [
                        { id: 1, text: 'Send thank you email to recruiter', done: true },
                        { id: 2, text: 'Research NextRoll CTV product', done: false },
                        { id: 3, text: 'Prepare 5 STAR stories', done: false },
                        { id: 4, text: 'Practice "what do you want" answer', done: false },
                        { id: 5, text: 'Prepare questions for hiring manager', done: false }
                    ]
                },
                {
                    id: 1707364800000,
                    company: 'Tatari',
                    role: 'Product Manager',
                    status: 'rejected',
                    date: '2026-02-08',
                    salary: 'Unknown',
                    location: 'Unknown',
                    url: '',
                    notes: 'REJECTED 2/11/26. Wrong fit - they wanted measurement/attribution analyst, not platform builder. Lesson learned: Need stronger answer for "what do you want from this role" question. Not a reflection of capability, just wrong role match.',
                    todos: []
                },
                {
                    id: 1707800000000,
                    company: 'Liftoff',
                    role: 'Staff Product Manager, ML Auction',
                    status: 'rejected',
                    date: 'Unknown',
                    salary: 'Unknown',
                    location: 'Remote',
                    url: '',
                    notes: 'Rejected pre-recruiter screen. Not a good fit - they needed more ML/auction experience.',
                    todos: []
                }
            ],
            interviews: [
                {
                    id: 1707364800001,
                    jobId: 1707364800000,
                    company: 'Tatari',
                    stage: 'Hiring Manager',
                    interviewer: 'Unknown',
                    date: '2026-02-08',
                    duration: '60',
                    outcome: 'Rejected',
                    questions: `1. Tell me about your experience in CTV advertising
2. What do you want from this role?
3. Walk me through your approach to measurement and attribution
4. How do you work with data science teams?`,
                    answers: `Struggled with "what do you want from this role" - wasn't prepared with strong answer. Lacked confidence in responses. Focused too much on platform building when they wanted measurement expertise.`,
                    yourQuestions: `1. What does success look like in the first 6 months?
2. How does the team work with data science?
3. What's the roadmap for measurement products?`,
                    notes: `Wrong fit - they wanted CTV measurement/attribution analyst; I'm a platform builder. Interviewer seemed focused on analytics and data interpretation, not product strategy. Not a reflection of my capability, just different role requirements.`,
                    followup: `LESSON LEARNED: Need better prepared answer for "what do you want from this role". Practice this for every interview.`
                },
                {
                    id: 1707710400000,
                    jobId: 1707624000000,
                    company: 'NextRoll',
                    stage: 'Recruiter Screen',
                    interviewer: 'Recruiter (name unknown)',
                    date: '2026-02-11',
                    duration: '30',
                    outcome: 'Passed',
                    questions: `1. Walk through your background
2. Why NextRoll?
3. What do you want from this role?
4. Salary expectations
5. Timeline/availability`,
                    answers: `Did okay on background - highlighted $57M CTV DSP build. Struggled with "what do you want" - need better answer. Mentioned interest in B2C+B2B approach and AI optimization. Gave salary range $180K-230K.`,
                    yourQuestions: `1. What's the interview process?
2. Timeline for hiring?
3. Team structure?`,
                    notes: `Overall went okay but not fully confident. MUST prep better "what do you want" answer: "I want to build world-class CTV products. Excited about B2C+B2B. Want to become THE CTV product leader."`,
                    followup: `‚úÖ Send thank you email (DONE)
‚òê Prep for hiring manager interview
‚òê Practice improved answers
‚òê Research NextRoll's current CTV product`
                }
            ],
            todos: [
                {
                    id: 1,
                    text: 'Send thank-you email to NextRoll recruiter',
                    done: true,
                    urgent: true
                },
                {
                    id: 2,
                    text: 'Write 5 STAR stories for interviews',
                    done: false,
                    urgent: true
                },
                {
                    id: 3,
                    text: 'Practice "what do you want" answer 10 times out loud',
                    done: false,
                    urgent: true
                },
                {
                    id: 4,
                    text: 'Research and apply to 2-3 new companies this week',
                    done: false,
                    urgent: true
                },
                {
                    id: 5,
                    text: 'Apply to The Trade Desk - Data Products role by 2/14',
                    done: false,
                    urgent: true
                },
                {
                    id: 6,
                    text: 'Apply to The Trade Desk - Channels/CTV role by 2/14',
                    done: false,
                    urgent: true
                },
                {
                    id: 7,
                    text: 'Apply to 2 more roles this week (Goal: 3 total)',
                    done: false,
                    urgent: true
                },
                {
                    id: 8,
                    text: 'Prepare NextRoll hiring manager interview questions',
                    done: false,
                    urgent: false
                },
                {
                    id: 9,
                    text: 'Update LinkedIn headline if needed',
                    done: true,
                    urgent: false
                },
                {
                    id: 10,
                    text: 'Research NextRoll\'s current CTV product offering',
                    done: false,
                    urgent: false
                },
                {
                    id: 11,
                    text: 'Find open roles at Roku by 2/17',
                    done: false,
                    urgent: false
                },
                {
                    id: 12,
                    text: 'Search for openings at Magnite by 2/17',
                    done: false,
                    urgent: false
                },
                {
                    id: 13,
                    text: 'Research Amazon Ads culture fit by 2/20',
                    done: false,
                    urgent: false
                },
                {
                    id: 14,
                    text: 'Practice interview answers out loud - record yourself on phone',
                    done: false,
                    urgent: false
                },
                {
                    id: 15,
                    text: 'Week of 2/17: Apply to 3-5 new roles (Trade Desk x2 + Roku + 1-2 more)',
                    done: false,
                    urgent: false
                },
                {
                    id: 16,
                    text: 'Week of 2/24: Apply to 3-5 new roles (keep pipeline full)',
                    done: false,
                    urgent: false
                }
            ],
            targets: [
                {
                    id: 1,
                    company: 'NextRoll',
                    role: 'Senior PM - CTV',
                    priority: 'HIGH',
                    why: 'Already applied and in interview process!'
                },
                {
                    id: 2,
                    company: 'The Trade Desk',
                    role: 'Senior PM - Data Products',
                    priority: 'HIGH',
                    why: 'Built data partnerships at Yahoo. DSP company. Apply by 2/14/2026.'
                },
                {
                    id: 3,
                    company: 'The Trade Desk',
                    role: 'Senior PM - Channels/CTV',
                    priority: 'HIGH',
                    why: 'Perfect CTV fit. Built $57M CTV DSP. Apply by 2/14/2026.'
                },
                {
                    id: 4,
                    company: 'Roku',
                    role: 'Senior PM - Ad Platform',
                    priority: 'MEDIUM',
                    why: 'CTV advertising platform. San Jose location. Find open roles by 2/17/2026.'
                },
                {
                    id: 5,
                    company: 'Magnite',
                    role: 'Senior PM - CTV/SSP',
                    priority: 'MEDIUM',
                    why: 'SSP focus. Worked with their platforms at Yahoo. Search for openings by 2/17/2026.'
                },
                {
                    id: 6,
                    company: 'Amazon Ads',
                    role: 'Senior PM - CTV',
                    priority: 'MEDIUM',
                    why: 'Massive CTV business. DSP expertise needed. Research culture fit by 2/20/2026.'
                },
                {
                    id: 7,
                    company: 'Viant',
                    role: 'Senior PM - DSP',
                    priority: 'LOW',
                    why: 'Independent DSP. CTV focus. Exploratory by 2/25/2026.'
                },
                {
                    id: 8,
                    company: 'Index Exchange',
                    role: 'Senior PM',
                    priority: 'LOW',
                    why: 'SSP - worked with them at Yahoo. Check openings by 2/25/2026.'
                }
            ],
            prepMaterials: [
                {
                    id: 1,
                    title: 'Master Resume - AdTech PM',
                    type: 'Resume',
                    company: '',
                    driveLink: '',
                    content: `SUMMARY:
Product Manager | Programmatic Advertising & Connected TV Specialist
12+ years building scalable AdTech platforms | $57M CTV DSP revenue | Cross-functional leadership

KEY ACHIEVEMENTS:
‚Ä¢ Built 0-to-1 CTV DSP generating $57M first-year revenue
‚Ä¢ Led 12-person engineering team + 3 designers + 2 data scientists
‚Ä¢ Integrated major SSPs/DSPs via OpenRTB (FreeWheel, SpotX, Xandr, Google Ad Manager)
‚Ä¢ Shipped Unified TV Measurement (52% reach increase, 49% conversion improvement)
‚Ä¢ Established data partnerships (Dish, Vizio, DirecTV) reducing 40% data gap
‚Ä¢ Engineering background: Principal SDE ‚Üí PM transition provides technical depth`,
                    date: '2/12/2026'
                },
                {
                    id: 2,
                    title: '"What Do You Want" Answer - MUST PRACTICE',
                    type: 'Interview Prep',
                    company: '',
                    driveLink: '',
                    content: `"I want to build world-class CTV advertising products that solve real business problems. After 7+ years at Yahoo building our CTV DSP from 0-to-1, I realized that's where I'm most energized - taking complex technical challenges and turning them into products that drive real revenue and impact.

What excites me about this role specifically is the opportunity to scale CTV across both B2C and B2B segments. That dual-market approach is exactly the kind of complexity I thrive on. And your focus on AI-driven optimization aligns perfectly with my experience partnering with data science teams to improve targeting and bidding.

In 2-3 years, I want to be THE go-to CTV product leader in the industry - someone who deeply understands the technology, the market dynamics, and how to build products that win. This role at [Company] is the perfect path to get there."

PRACTICE THIS 10 TIMES OUT LOUD BEFORE EVERY INTERVIEW!`,
                    date: '2/12/2026'
                },
                {
                    id: 3,
                    title: '5 STAR Stories - Product Success',
                    type: 'STAR Stories',
                    company: '',
                    driveLink: '',
                    content: `STORY 1: Built $57M CTV DSP (0-to-1 Product Build)
Situation: Yahoo needed to enter CTV advertising market
Task: Build enterprise-grade CTV DSP platform from scratch
Action: Led cross-functional team (12 eng, 3 design, 2 DS), integrated major SSPs via OpenRTB, shipped in 18 months
Result: $57M first-year revenue, became key revenue driver

STORY 2: Data Science Collaboration (ML Optimization)
Situation: Ad relevance and targeting needed improvement
Task: Partner with data science to build ML-powered optimization
Action: Defined requirements, collaborated on model design, integrated into platform
Result: 38% improvement in ad relevance, better ROI for advertisers

STORY 3: Cross-Functional Leadership (Unified TV Measurement)
Situation: Customers needed unified measurement across linear and streaming TV
Task: Build tool to bridge traditional and digital TV metrics
Action: Coordinated with GTM, engineering, data teams; navigated complex stakeholder needs
Result: 52% reach increase, 49% conversion improvement, major competitive advantage

STORY 4: Difficult Stakeholder (Conflicting Priorities)
Situation: Sales wanted feature X, Engineering preferred Y due to technical debt
Task: Resolve conflict and align on path forward
Action: Facilitated meetings, presented data-driven analysis, proposed phased approach
Result: Satisfied both teams, feature shipped on time with debt reduction plan

STORY 5: Failure & Learning (Feature Deprioritization)
Situation: Built feature customers didn't adopt
Task: Understand why and course-correct
Action: Conducted user research, discovered misaligned assumptions
Result: Learned to validate assumptions earlier; pivoted to successful alternative`,
                    date: '2/12/2026'
                },
                {
                    id: 4,
                    title: 'NextRoll - Interview Prep',
                    type: 'Research Notes',
                    company: 'NextRoll',
                    driveLink: '',
                    content: `COMPANY RESEARCH:
‚Ä¢ Builds CTV advertising platform (DSP-focused) - PERFECT MATCH
‚Ä¢ Serves B2C and B2B marketers - I have experience with both
‚Ä¢ AI-driven optimization focus - aligns with my DS partnership experience
‚Ä¢ Cross-channel integration approach - matches my Unified TV Measurement work

WHY PERFECT FIT:
‚Ä¢ Building CTV platform = my exact expertise
‚Ä¢ B2C + B2B = I worked with both at Yahoo
‚Ä¢ 5+ years CTV/programmatic required = I have 7+
‚Ä¢ Cross-functional leadership = led 12-person eng team

QUESTIONS TO ASK THEM:
1. What's the biggest gap in your current CTV product?
2. How mature is CTV offering today vs 12-month goal?
3. What does success look like in first 6 months?
4. How does CTV integrate with retargeting and ABM products?
5. Team structure: engineers, designers, data scientists?

GLASSDOOR INSIGHTS:
‚Ä¢ NextRoll gives interview questions ahead of time
‚Ä¢ Known for transparency
‚Ä¢ Process: Recruiter ‚Üí Hiring Manager ‚Üí Virtual Onsite (3-4 rounds) ‚Üí Final

KEY TALKING POINTS:
‚úì $57M CTV DSP build
‚úì B2C + B2B experience
‚úì ML optimization partnership
‚úì Cross-functional leadership
‚úì Measurement expertise`,
                    date: '2/12/2026'
                },
                {
                    id: 5,
                    title: 'Cover Letter Template (2 Paragraphs)',
                    type: 'Cover Letter',
                    company: '',
                    driveLink: '',
                    content: `I'm reaching out about the [ROLE] position at [COMPANY]. Over 12+ years as a Product Manager in AdTech, I've specialized in building CTV and programmatic advertising platforms - most recently leading Yahoo's 0-to-1 CTV DSP that generated $57M in first-year revenue. I've integrated major SSPs and DSPs via OpenRTB, led cross-functional teams of 12+ engineers, and shipped measurement tools that drove 52% reach increases and 49% conversion improvements.

I took an intentional career break in 2023-2024 for personal priorities while maintaining my product skills through independent project development. Now I'm actively seeking my next role in AdTech product leadership, and [COMPANY]'s [SPECIFIC THING ABOUT COMPANY] particularly excites me. I'd love to discuss how my CTV platform expertise and cross-functional leadership can contribute to [COMPANY]'s growth.`,
                    date: '2/12/2026'
                },
                {
                    id: 6,
                    title: 'Career Gap Explanation',
                    type: 'Interview Prep',
                    company: '',
                    driveLink: '',
                    content: `IF ASKED ABOUT 2023-2024 GAP:

"I took an intentional career break for personal priorities while maintaining my product skills through independent project development. It was the right decision at the time, and now I'm energized and ready to dive back into AdTech product leadership full-time."

THEN PIVOT IMMEDIATELY TO FORWARD-LOOKING:
"What excites me about this role is [specific thing about the company/role]. I'm ready to bring my 12+ years of experience building CTV platforms to [Company]."

KEY PRINCIPLES:
‚úì Brief and matter-of-fact
‚úì Use "intentional" (shows it was a choice)
‚úì Don't apologize or dwell
‚úì Pivot quickly to what you bring
‚úì Don't mention other rejections
‚úó Don't over-explain
‚úó Don't say "struggling" or "difficult time"`,
                    date: '2/12/2026'
                }
            ]
        };

        // Initialize
        let resumes = [];
        
        // Render Timeline
        function renderTimeline() {
            const container = document.getElementById('timelineView');
            const allEvents = [];
            jobs.forEach(job => {
                if (job.date) allEvents.push({date: new Date(job.date), title: `Applied to ${job.company}`, description: job.role});
            });
            interviews.forEach(int => {
                if (int.date) allEvents.push({date: new Date(int.date), title: `Interview: ${int.company}`, description: int.stage || 'Interview'});
            });
            allEvents.sort((a, b) => b.date - a.date);
            if (allEvents.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìÖ</div><p>No events. Add applications and interviews to see timeline.</p></div>';
                return;
            }
            container.innerHTML = allEvents.map(e => `<div class="timeline-item"><div class="timeline-content"><div class="timeline-date">${e.date.toLocaleDateString()}</div><div class="timeline-title">${e.title}</div><div class="timeline-desc">${e.description}</div></div></div>`).join('');
        }
        
        // Resumes
        function renderResumes() {
            const c = document.getElementById('resumesList');
            if (resumes.length === 0) {
                c.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìÑ</div><p>No resumes. Upload your resume versions.</p></div>';
                return;
            }
            c.innerHTML = resumes.map(r => `<div class="resume-card"><div class="resume-info"><div class="resume-name">üìÑ ${r.name}</div><div class="resume-date">Uploaded: ${r.date}</div></div><div class="resume-actions"><button class="resume-btn resume-download" onclick="downloadResume(${r.id})">‚¨áÔ∏è Download</button><button class="resume-btn resume-delete" onclick="deleteResume(${r.id})">Delete</button></div></div>`).join('');
        }
        
        function openResumeUploadModal() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.pdf,.doc,.docx';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (evt) => {
                        resumes.push({id: Date.now(), name: file.name, date: new Date().toLocaleDateString(), data: evt.target.result});
                        renderResumes();
                        alert('Resume uploaded!');
                    };
                    reader.readAsArrayBuffer(file);
                }
            };
            input.click();
        }
        
        function downloadResume(id) {
            const r = resumes.find(x => x.id === id);
            if (r) {
                const blob = new Blob([r.data]);
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = r.name;
                a.click();
                URL.revokeObjectURL(url);
            }
        }
        
        function deleteResume(id) {
            if (confirm('Delete?')) {
                resumes = resumes.filter(r => r.id !== id);
                renderResumes();
            }
        }
        
        function downloadCSVTemplate() {
            const csv = 'Company,Role,Status,Location,Salary,Date Applied,Notes\nStripe,Product Manager,Applied,San Francisco CA,$180K-$220K,2026-02-10,Good fit\nGoogle,Senior PM,In Review,Mountain View CA,$200K-$250K,2026-02-08,YouTube';
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'jobs-template.csv';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function importCSV(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const lines = e.target.result.split('\n').filter(l => l.trim());
                    let imported = 0;
                    for (let i = 1; i < lines.length; i++) {
                        const vals = lines[i].split(',');
                        const job = {id: Date.now() + i, company: vals[0]?.trim() || '', role: vals[1]?.trim() || '', status: vals[2]?.trim() || 'applied', location: vals[3]?.trim() || '', salary: vals[4]?.trim() || '', date: vals[5]?.trim() || '', notes: vals[6]?.trim() || '', url: '', todos: []};
                        if (job.company && job.role) {
                            jobs.push(job);
                            imported++;
                        }
                    }
                    saveUserData();
                    renderAll();
                    alert(`Imported ${imported} jobs!`);
                } catch (err) {
                    alert('Error: ' + err.message);
                }
            };
            reader.readAsText(file);
        }
        
        async function init() {
            const savedUser = localStorage.getItem('jobTrackerUsername');
            if (savedUser) {
                currentUsername = savedUser;
                await loadUserData();
                showApp();
            }
        }

        // Login
        async function login() {
            const username = document.getElementById('usernameInput').value.trim();
            if (!username) {
                alert('Please enter a username');
                return;
            }
            
            currentUsername = username;
            localStorage.setItem('jobTrackerUsername', username);
            await loadUserData();
            showApp();
        }

        // Logout
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('jobTrackerUsername');
                currentUsername = null;
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('appContainer').style.display = 'none';
            }
        }

        // Show app
        function showApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            document.getElementById('currentUser').textContent = currentUsername;
        }

        // Storage key helpers
        function getUserKey(type) {
            return `jobtracker_${currentUsername}_${type}`;
        }

        // Load user data
        async function loadUserData() {
            try {
                const jobsData = localStorage.getItem(getUserKey('jobs'));
                
                // Check if this is a new user (no data yet)
                if (!jobsData && currentUsername.toLowerCase() === 'prachiti') {
                    // First time user - populate with initial data
                    jobs = initialData.jobs;
                    interviews = initialData.interviews;
                    todos = initialData.todos;
                    targets = initialData.targets;
                    prepMaterials = initialData.prepMaterials;
                    
                    // Save to storage
                    await saveUserData();
                    renderAll();
                    return;
                }
                
                // Load existing data
                jobs = jobsData ? JSON.parse(jobsData) : [];

                const interviewsData = localStorage.getItem(getUserKey('interviews'));
                interviews = interviewsData ? JSON.parse(interviewsData) : [];

                const todosData = localStorage.getItem(getUserKey('todos'));
                todos = todosData ? JSON.parse(todosData) : [];

                const targetsData = localStorage.getItem(getUserKey('targets'));
                targets = targetsData ? JSON.parse(targetsData) : [];

                const prepData = localStorage.getItem(getUserKey('prep'));
                prepMaterials = prepData ? JSON.parse(prepData) : [];

                renderAll();
            } catch (error) {
                console.log('New user or error loading data:', error);
                jobs = [];
                interviews = [];
                todos = [];
                targets = [];
                prepMaterials = [];
                renderAll();
            }
        }

        // Save user data
        async function saveUserData() {
            try {
                localStorage.setItem(getUserKey('jobs'), JSON.stringify(jobs));
                localStorage.setItem(getUserKey('interviews'), JSON.stringify(interviews));
                localStorage.setItem(getUserKey('todos'), JSON.stringify(todos));
                localStorage.setItem(getUserKey('targets'), JSON.stringify(targets));
                localStorage.setItem(getUserKey('prep'), JSON.stringify(prepMaterials));
            } catch (error) {
                console.error('Error saving data:', error);
                alert('Error saving data. Please try again.');
            }
        }

        // Render all
        function renderAll() {
            renderJobs();
            renderInterviews();
            renderTodos();
            renderTargets();
            renderPrepMaterials();
            renderTimeline();
            renderResumes();
            updateStats();
        }

        // Switch tabs
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Render urgent todos in the momentum banner
        function renderUrgentTodos() {
            const urgentContainer = document.getElementById('urgentTodosList');
            if (!urgentContainer) return;
            
            // Get all urgent todos that aren't done
            const urgentTodos = todos.filter(t => t.urgent && !t.done);
            
            // Also get job-specific urgent todos
            const jobUrgentTodos = [];
            jobs.forEach(job => {
                if (job.todos && job.todos.length > 0) {
                    const jobUrgent = job.todos.filter(t => !t.done).slice(0, 2); // Max 2 per job
                    jobUrgent.forEach(t => {
                        jobUrgentTodos.push({
                            text: `${job.company}: ${t.text}`,
                            jobId: job.id,
                            todoId: t.id
                        });
                    });
                }
            });
            
            // Combine and limit to top 5
            const allUrgent = [
                ...urgentTodos.map(t => ({ text: t.text, globalId: t.id })),
                ...jobUrgentTodos.slice(0, 3)
            ].slice(0, 5);
            
            if (allUrgent.length === 0) {
                urgentContainer.innerHTML = '<li>üéâ All caught up! Keep applying to new roles.</li>';
                return;
            }
            
            urgentContainer.innerHTML = allUrgent.map(item => {
                if (item.globalId) {
                    return `<li onclick="goToTodoTab()" style="cursor: pointer;">${item.text}</li>`;
                } else {
                    return `<li>${item.text}</li>`;
                }
            }).join('');
        }
        
        function goToTodoTab() {
            switchTab('todo');
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab')[3].classList.add('active');
        }

        // Filter and search jobs
        function getFilteredJobs() {
            const searchTerm = document.getElementById('jobSearch')?.value.toLowerCase() || '';
            const statusFilter = document.getElementById('statusFilter')?.value || 'all';
            
            return jobs.filter(job => {
                const matchesSearch = !searchTerm || 
                    job.company.toLowerCase().includes(searchTerm) ||
                    job.role.toLowerCase().includes(searchTerm) ||
                    job.location.toLowerCase().includes(searchTerm);
                
                const matchesStatus = statusFilter === 'all' || job.status === statusFilter;
                
                return matchesSearch && matchesStatus;
            });
        }
        
        // Update statistics
        function updateStats() {
            const appliedCount = jobs.filter(j => j.status === 'applied').length;
            const reviewCount = jobs.filter(j => j.status === 'in review').length;
            const interviewCount = jobs.filter(j => j.status === 'interview').length;
            const offerCount = jobs.filter(j => j.status === 'offer').length;
            
            document.getElementById('statTotal').textContent = jobs.length;
            document.getElementById('statApplied').textContent = appliedCount;
            document.getElementById('statReview').textContent = reviewCount;
            document.getElementById('statInterviews').textContent = interviewCount;
            document.getElementById('statOffers').textContent = offerCount;
        }
        }

        // Render jobs
        function renderJobs() {
            // Render urgent todos banner first
            renderUrgentTodos();
            
            const container = document.getElementById('jobsList');
            const filteredJobs = getFilteredJobs();
            
            if (filteredJobs.length === 0) {
                if (jobs.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì≠</div><p>No applications yet. Click "Add Application" to get started!</p></div>';
                } else {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üîç</div><p>No jobs match your search/filter</p></div>';
                }
                return;
            }

            container.innerHTML = filteredJobs.map(job => `
                <div class="job-card">
                    <div class="job-header">
                        <div>
                            <div class="job-company">${job.company}</div>
                            <div class="job-title">${job.role}</div>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            ${getInterviewBadge(job.id)}
                            <span class="job-status status-${job.status}">${job.status.toUpperCase()}</span>
                        </div>
                    </div>
                    <div class="job-details">
                        <div class="detail-item">
                            <span class="detail-label">üìÖ Applied:</span> ${job.date || 'Not set'}
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">üí∞ Salary:</span> ${job.salary || 'Not specified'}
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">üìç Location:</span> ${job.location || 'Not specified'}
                        </div>
                        ${job.url ? `<div class="detail-item" style="grid-column: 1 / -1;">
                            <span class="detail-label">üîó Job Posting:</span> <a href="${job.url}" target="_blank" style="color: #667eea; text-decoration: underline;">View Job Post</a>
                        </div>` : ''}
                    </div>
                    ${job.notes ? `<div class="job-notes">üìù ${job.notes}</div>` : ''}
                    ${getJobTodos(job)}
                    ${getLinkedInterviews(job.id)}
                    <div class="action-buttons">
                        <button class="btn btn-update" onclick="editJob(${job.id})">‚úèÔ∏è Edit</button>
                        <button class="btn btn-update" onclick="addJobTodo(${job.id})" style="background: #4caf50;">‚úÖ Add To-Do</button>
                        <button class="btn btn-update" onclick="addInterviewForJob(${job.id})">+ Add Interview</button>
                        <button class="btn btn-delete" onclick="deleteJob(${job.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Render interviews
        function renderInterviews() {
            const container = document.getElementById('interviewsList');
            if (interviews.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üé§</div><p>No interviews yet. Keep applying!</p></div>';
                return;
            }

            container.innerHTML = interviews.map(interview => {
                const linkedJob = interview.jobId ? jobs.find(j => j.id === interview.jobId) : null;
                return `
                <div class="job-card">
                    <div class="job-header">
                        <div>
                            <div class="job-company">${interview.company}</div>
                            <div class="job-title">${interview.stage}</div>
                            ${linkedJob ? `<div style="font-size: 0.9em; color: #667eea; margin-top: 5px;">üîó Linked to: ${linkedJob.role}</div>` : ''}
                            ${interview.interviewer ? `<div style="font-size: 0.9em; color: #666; margin-top: 5px;">üë§ ${interview.interviewer}</div>` : ''}
                        </div>
                        <span class="job-status ${interview.outcome === 'Passed' ? 'status-offer' : interview.outcome === 'Rejected' ? 'status-rejected' : 'status-waiting'}">${interview.outcome}</span>
                    </div>
                    <div class="job-details">
                        <div class="detail-item">
                            <span class="detail-label">üìÖ Date:</span> ${interview.date || 'Not set'}
                        </div>
                        ${interview.duration ? `<div class="detail-item"><span class="detail-label">‚è±Ô∏è Duration:</span> ${interview.duration} min</div>` : ''}
                    </div>
                    
                    ${interview.questions ? `
                        <div style="margin-top: 15px; padding: 15px; background: #fff3e0; border-radius: 8px;">
                            <div style="font-weight: 600; color: #e65100; margin-bottom: 8px;">‚ùì Questions They Asked:</div>
                            <div style="color: #666; white-space: pre-wrap; font-size: 0.95em;">${interview.questions}</div>
                        </div>
                    ` : ''}
                    
                    ${interview.answers ? `
                        <div style="margin-top: 15px; padding: 15px; background: #e8f5e9; border-radius: 8px;">
                            <div style="font-weight: 600; color: #2e7d32; margin-bottom: 8px;">üí¨ Your Answers / Performance:</div>
                            <div style="color: #666; white-space: pre-wrap; font-size: 0.95em;">${interview.answers}</div>
                        </div>
                    ` : ''}
                    
                    ${interview.yourQuestions ? `
                        <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 8px;">
                            <div style="font-weight: 600; color: #1565c0; margin-bottom: 8px;">ü§î Questions You Asked:</div>
                            <div style="color: #666; white-space: pre-wrap; font-size: 0.95em;">${interview.yourQuestions}</div>
                        </div>
                    ` : ''}
                    
                    ${interview.notes ? `
                        <div style="margin-top: 15px; padding: 15px; background: #f3e5f5; border-radius: 8px;">
                            <div style="font-weight: 600; color: #7b1fa2; margin-bottom: 8px;">üí° Overall Notes & Lessons:</div>
                            <div style="color: #666; white-space: pre-wrap; font-size: 0.95em;">${interview.notes}</div>
                        </div>
                    ` : ''}
                    
                    ${interview.followup ? `
                        <div style="margin-top: 15px; padding: 15px; background: #fff9c4; border-radius: 8px;">
                            <div style="font-weight: 600; color: #f57f17; margin-bottom: 8px;">‚úÖ Follow-up Actions:</div>
                            <div style="color: #666; white-space: pre-wrap; font-size: 0.95em;">${interview.followup}</div>
                        </div>
                    ` : ''}
                    
                    <div class="action-buttons">
                        ${linkedJob ? `<button class="btn btn-update" onclick="viewLinkedJob(${linkedJob.id})">View Application</button>` : ''}
                        <button class="btn btn-delete" onclick="deleteInterview(${interview.id})">Delete</button>
                    </div>
                </div>
            `}).join('');
        }

        // Render todos
        function renderTodos() {
            const container = document.getElementById('todoList');
            if (todos.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚úÖ</div><p>No to-dos yet. Add your first task!</p></div>';
                return;
            }

            container.innerHTML = todos.map(todo => `
                <div class="job-card" style="${todo.done ? 'opacity: 0.5;' : ''}">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <input type="checkbox" ${todo.done ? 'checked' : ''} onchange="toggleTodo(${todo.id})" style="width: 20px; height: 20px; cursor: pointer;">
                        <div style="flex: 1;">
                            <span style="font-size: 1.1em; ${todo.done ? 'text-decoration: line-through;' : ''}">${todo.urgent ? 'üî• ' : ''}${todo.text}</span>
                        </div>
                        <button class="btn btn-delete" onclick="deleteTodo(${todo.id})" style="padding: 6px 12px;">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Render targets
        function renderTargets() {
            const container = document.getElementById('targetsList');
            if (targets.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üéØ</div><p>No target companies yet. Add companies you want to apply to!</p></div>';
                return;
            }

            container.innerHTML = targets.map(target => `
                <div class="job-card">
                    <div class="job-header">
                        <div>
                            <div class="job-company">${target.company}</div>
                            <div class="job-title">${target.role}</div>
                        </div>
                        <span class="job-status ${target.priority === 'HIGH' ? 'status-rejected' : target.priority === 'MEDIUM' ? 'status-interview' : 'status-applied'}">${target.priority}</span>
                    </div>
                    ${target.why ? `<div class="job-notes">üí° ${target.why}</div>` : ''}
                    <div class="action-buttons">
                        <button class="btn btn-update" onclick="markApplied(${target.id})">Mark as Applied</button>
                        <button class="btn btn-delete" onclick="deleteTarget(${target.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Render prep materials
        function renderPrepMaterials() {
            const container = document.getElementById('prepList');
            if (prepMaterials.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìÑ</div><p>No prep materials yet. Add your resumes, cover letters, and interview prep notes!</p></div>';
                return;
            }

            // Group by type
            const grouped = {};
            prepMaterials.forEach(prep => {
                if (!grouped[prep.type]) grouped[prep.type] = [];
                grouped[prep.type].push(prep);
            });

            container.innerHTML = Object.keys(grouped).map(type => `
                <div style="margin-bottom: 30px;">
                    <h3 style="color: #667eea; margin-bottom: 15px; font-size: 1.2em;">${type}</h3>
                    ${grouped[type].map(prep => `
                        <div class="job-card">
                            <div class="job-header">
                                <div>
                                    <div class="job-title">
                                        ${prep.driveLink ? '‚òÅÔ∏è ' : ''}${prep.title}
                                    </div>
                                    ${prep.company ? `<div style="color: #667eea; font-size: 0.95em; margin-top: 5px;">For: ${prep.company}</div>` : ''}
                                </div>
                                <span class="job-status status-applied">${prep.type}</span>
                            </div>
                            <div style="color: #666; font-size: 0.9em; margin-top: 10px;">
                                üìÖ Added: ${prep.date}
                                ${prep.driveLink ? ' ‚Ä¢ ‚òÅÔ∏è <span style="color: #4285f4; font-weight: 600;">Stored in Drive</span>' : ''}
                            </div>
                            ${prep.content ? `<div class="job-notes" style="margin-top: 10px; max-height: 100px; overflow: hidden;">üìù ${prep.content.substring(0, 150)}${prep.content.length > 150 ? '...' : ''}</div>` : ''}
                            <div class="action-buttons">
                                ${prep.driveLink ? `<button class="btn btn-update" onclick="window.open('${prep.driveLink}', '_blank')" style="background: #4285f4;">‚òÅÔ∏è Open in Drive</button>` : ''}
                                ${prep.content ? `<button class="btn btn-update" onclick="viewPrep(${prep.id})">üìñ View Notes</button>` : ''}
                                ${prep.content ? `<button class="btn btn-update" onclick="copyPrepToClipboard(${prep.id})" style="background: #4caf50;">üìã Copy Notes</button>` : ''}
                                <button class="btn btn-delete" onclick="deletePrep(${prep.id})">Delete</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `).join('');
        }

        // Update stats
        function updateStats() {
            document.getElementById('totalApps').textContent = jobs.length;
            document.getElementById('activeCount').textContent = jobs.filter(j => j.status !== 'rejected').length;
            document.getElementById('interviewCount').textContent = interviews.length;
            const responseRate = jobs.length > 0 ? Math.round((interviews.length / jobs.length) * 100) : 0;
            document.getElementById('responseRate').textContent = responseRate + '%';
        }

        // Modal functions
        function openAddJobModal() {
            document.getElementById('addJobModal').classList.add('active');
        }

        function openAddInterviewModal() {
            // Populate the job dropdown
            const dropdown = document.getElementById('interviewJobId');
            dropdown.innerHTML = '<option value="">Select an application (optional)</option>' +
                jobs.filter(j => j.status !== 'rejected')
                    .map(j => `<option value="${j.id}">${j.company} - ${j.role}</option>`)
                    .join('');
            document.getElementById('addInterviewModal').classList.add('active');
        }

        function openAddTodoModal() {
            document.getElementById('addTodoModal').classList.add('active');
        }

        function openAddTargetModal() {
            document.getElementById('addTargetModal').classList.add('active');
        }
        
        // Prep Template Content
        const prepTemplates = {
            'STAR Story Template': `SITUATION: Describe the context and challenge
- What was the problem/goal?
- Who was involved?
- When did it happen?

TASK: What were you responsible for?
- Your specific role
- Key metrics involved

ACTION: What exactly did you do?
- Specific steps you took
- Tools/technologies used
- How you worked with others

RESULT: What were the outcomes?
- Metrics/numbers
- What you learned
- Impact on the team/company`,

            'System Design Prep': `1. Clarify Requirements:
   - Functional requirements
   - Non-functional requirements
   - Scale/traffic

2. Capacity Estimation:
   - Requests per second
   - Storage requirements
   - Bandwidth needed

3. System APIs:
   - Core functions
   - Input/output

4. Database Design:
   - Schema
   - SQL vs NoSQL
   - Indexes

5. High-Level Design:
   - Component diagrams
   - Data flow

6. Detailed Design:
   - Load balancing
   - Caching
   - Database replication

7. Bottlenecks & Trade-offs:
   - Identify weak points
   - Optimization options`,

            'Product Case Study': `PRODUCT: [Company Name]
- What is it?
- Who uses it?
- Key metrics

THE PROBLEM:
- User pain point
- Market opportunity
- Why does it matter?

YOUR SOLUTION:
- Feature/improvement
- How it solves the problem
- User journey

METRICS & SUCCESS:
- How would you measure success?
- Expected impact
- Key metrics to track

CHALLENGES:
- Technical challenges
- User adoption
- Competition

ALTERNATIVES:
- Other solutions considered
- Why your approach is better`,

            'Behavioral Questions': `Common Questions:
1. "Tell me about yourself"
   - Background
   - Key achievements
   - Why this role interests you

2. "Why do you want to join our company?"
   - Company research
   - Alignment with values
   - Specific interest in role

3. "Tell me about a time you failed"
   - Specific example
   - What you learned
   - How you improved

4. "How do you handle conflict?"
   - Specific situation
   - Your approach
   - Positive outcome

5. "What are your strengths/weaknesses?"
   - Be specific
   - Give examples
   - Frame weaknesses positively`,

            'Cover Letter Template': `[Your Name]
[Your Email] | [Your Phone] | [LinkedIn Profile]

[Date]

Dear Hiring Manager,

Opening: Express genuine interest in the role and company.

Body: Highlight 2-3 key accomplishments that match the job requirements.

Closing: Express enthusiasm and call to action.

Best regards,
[Your Name]

---

TIPS:
- Keep it to one page
- Address to a specific person if possible
- Show you've researched the company
- Focus on what you can do for them`,

            'Research Checklist': `Company Research:
‚ñ° Company mission/values
‚ñ° Recent news/funding
‚ñ° Product/service offering
‚ñ° Market position
‚ñ° Company culture
‚ñ° Recent product launches

Role Research:
‚ñ° Job description details
‚ñ° Team structure
‚ñ° Key metrics/OKRs
‚ñ° Challenges the role faces
‚ñ° Required vs nice-to-have skills

Preparation:
‚ñ° Questions to ask them
‚ñ° Your value proposition
‚ñ° STAR stories ready
‚ñ° Technical prep (if applicable)
‚ñ° Salary research

Day Before:
‚ñ° Review company mission
‚ñ° Plan your route/video setup
‚ñ° Prepare clothes
‚ñ° Test technology
‚ñ° Get good sleep`
        };
        
        function addPrepTemplate(templateName) {
            const content = prepTemplates[templateName] || templateName;
            document.getElementById('prepTitle').value = templateName;
            document.getElementById('prepType').value = 'template';
            document.getElementById('prepContent').value = content;
            document.getElementById('prepCompany').value = '';
            openAddPrepModal();
        }

        function openAddPrepModal() {
            document.getElementById('addPrepModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Add job
        async function addJob(e) {
            console.log('addJob function called');
            e.preventDefault();
            
            try {
                // Validate required fields
                const company = document.getElementById('jobCompany').value.trim();
                const role = document.getElementById('jobRole').value.trim();
                
                console.log('Company:', company);
                console.log('Role:', role);
                
                if (!company || !role) {
                    alert('Please enter Company and Role');
                    return;
                }
                
                const newJob = {
                    id: Date.now(),
                    company: company,
                    role: role,
                    status: document.getElementById('jobStatus').value || 'applied',
                    date: document.getElementById('jobDate').value || new Date().toISOString().split('T')[0],
                    salary: document.getElementById('jobSalary').value.trim() || 'Not specified',
                    location: document.getElementById('jobLocation').value.trim() || 'Not specified',
                    url: document.getElementById('jobUrl').value.trim() || '',
                    notes: document.getElementById('jobNotes').value.trim() || '',
                    todos: []
                };
                
                console.log('New job object:', newJob);
                
                jobs.unshift(newJob);
                console.log('Added to jobs array. Total jobs:', jobs.length);
                
                await saveUserData();
                console.log('Saved to storage');
                
                renderAll();
                console.log('Rendered all');
                
                closeModal('addJobModal');
                console.log('Closed modal');
                
                document.getElementById('addJobForm').reset();
                console.log('Form reset');
                
                alert('‚úÖ Application added successfully!');
            } catch (error) {
                console.error('ERROR in addJob:', error);
                alert('Error adding application: ' + error.message);
            }
        }

        // Edit job
        function editJob(id) {
            const job = jobs.find(j => j.id === id);
            if (!job) {
                alert('Job not found');
                return;
            }
            
            // Populate the edit form
            document.getElementById('editJobId').value = job.id;
            document.getElementById('editJobCompany').value = job.company;
            document.getElementById('editJobRole').value = job.role;
            document.getElementById('editJobStatus').value = job.status;
            document.getElementById('editJobDate').value = job.date !== 'Not set' ? job.date : '';
            document.getElementById('editJobSalary').value = job.salary !== 'Not specified' ? job.salary : '';
            document.getElementById('editJobLocation').value = job.location !== 'Not specified' ? job.location : '';
            document.getElementById('editJobUrl').value = job.url || '';
            document.getElementById('editJobNotes').value = job.notes || '';
            
            // Open the edit modal
            document.getElementById('editJobModal').classList.add('active');
        }

        // Save edited job
        async function saveEditJob(e) {
            e.preventDefault();
            
            try {
                const jobId = parseInt(document.getElementById('editJobId').value);
                const jobIndex = jobs.findIndex(j => j.id === jobId);
                
                if (jobIndex === -1) {
                    alert('Job not found');
                    return;
                }
                
                // Update the job
                jobs[jobIndex] = {
                    id: jobId,
                    company: document.getElementById('editJobCompany').value.trim(),
                    role: document.getElementById('editJobRole').value.trim(),
                    status: document.getElementById('editJobStatus').value,
                    date: document.getElementById('editJobDate').value || new Date().toISOString().split('T')[0],
                    salary: document.getElementById('editJobSalary').value.trim() || 'Not specified',
                    location: document.getElementById('editJobLocation').value.trim() || 'Not specified',
                    url: document.getElementById('editJobUrl').value.trim() || '',
                    notes: document.getElementById('editJobNotes').value.trim() || '',
                    todos: jobs[jobIndex].todos || []
                };
                
                await saveUserData();
                renderAll();
                closeModal('editJobModal');
                document.getElementById('editJobForm').reset();
                
                alert('‚úÖ Application updated successfully!');
            } catch (error) {
                console.error('ERROR in saveEditJob:', error);
                alert('Error updating application: ' + error.message);
            }
        }

        // Add interview
        async function addInterview(e) {
            e.preventDefault();
            const jobId = document.getElementById('interviewJobId').value;
            const newInterview = {
                id: Date.now(),
                jobId: jobId ? parseInt(jobId) : null,
                company: document.getElementById('interviewCompany').value,
                stage: document.getElementById('interviewStage').value,
                interviewer: document.getElementById('interviewInterviewer').value.trim() || '',
                date: document.getElementById('interviewDate').value || 'Not set',
                duration: document.getElementById('interviewDuration').value || '',
                outcome: document.getElementById('interviewOutcome').value,
                questions: document.getElementById('interviewQuestions').value.trim() || '',
                answers: document.getElementById('interviewAnswers').value.trim() || '',
                yourQuestions: document.getElementById('interviewYourQuestions').value.trim() || '',
                notes: document.getElementById('interviewNotes').value.trim() || '',
                followup: document.getElementById('interviewFollowup').value.trim() || ''
            };
            interviews.unshift(newInterview);
            
            // Update job status to interview if linked
            if (jobId) {
                const job = jobs.find(j => j.id === parseInt(jobId));
                if (job && job.status === 'waiting') {
                    job.status = 'interview';
                }
            }
            
            await saveUserData();
            renderAll();
            closeModal('addInterviewModal');
            document.getElementById('addInterviewForm').reset();
        }
        
        // Helper functions for linking
        function getInterviewBadge(jobId) {
            const count = interviews.filter(i => i.jobId === jobId).length;
            if (count === 0) return '';
            return `<span style="background: #667eea; color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.85em;">üé§ ${count} interview${count > 1 ? 's' : ''}</span>`;
        }
        
        function getLinkedInterviews(jobId) {
            const linkedInterviews = interviews.filter(i => i.jobId === jobId);
            if (linkedInterviews.length === 0) return '';
            
            return `<div style="margin-top: 15px; padding: 15px; background: #f0f4ff; border-radius: 8px; border-left: 3px solid #667eea;">
                <div style="font-weight: 600; color: #667eea; margin-bottom: 10px;">üé§ Interviews (${linkedInterviews.length}):</div>
                ${linkedInterviews.map(i => `
                    <div style="padding: 8px 0; border-bottom: 1px solid #e0e0e0; font-size: 0.95em;">
                        <span style="font-weight: 600;">${i.stage}</span> - ${i.date} - <span style="color: ${i.outcome === 'Passed' ? '#388e3c' : i.outcome === 'Rejected' ? '#d32f2f' : '#666'};">${i.outcome}</span>
                    </div>
                `).join('')}
            </div>`;
        }
        
        function getJobTodos(job) {
            if (!job.todos || job.todos.length === 0) return '';
            
            const completedCount = job.todos.filter(t => t.done).length;
            const totalCount = job.todos.length;
            
            return `<div style="margin-top: 15px; padding: 15px; background: #fff3e0; border-radius: 8px; border-left: 3px solid #ff9800;">
                <div style="font-weight: 600; color: #e65100; margin-bottom: 10px;">
                    ‚úÖ To-Dos (${completedCount}/${totalCount} complete)
                </div>
                ${job.todos.map(todo => `
                    <div style="padding: 6px 0; display: flex; align-items: center; gap: 10px; font-size: 0.95em;">
                        <input type="checkbox" ${todo.done ? 'checked' : ''} 
                               onchange="toggleJobTodo(${job.id}, ${todo.id})" 
                               style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="${todo.done ? 'text-decoration: line-through; color: #999;' : 'color: #333;'}">${todo.text}</span>
                        <button onclick="deleteJobTodo(${job.id}, ${todo.id})" 
                                style="margin-left: auto; background: none; border: none; color: #d32f2f; cursor: pointer; font-size: 1.2em;" 
                                title="Delete">√ó</button>
                    </div>
                `).join('')}
            </div>`;
        }
        
        function addJobTodo(jobId) {
            const job = jobs.find(j => j.id === jobId);
            if (!job) return;
            
            const todoText = prompt(`Add a to-do for ${job.company}:`, '');
            if (!todoText || !todoText.trim()) return;
            
            if (!job.todos) job.todos = [];
            
            const newTodo = {
                id: Date.now(),
                text: todoText.trim(),
                done: false
            };
            
            job.todos.push(newTodo);
            saveUserData();
            renderAll();
        }
        
        async function toggleJobTodo(jobId, todoId) {
            const job = jobs.find(j => j.id === jobId);
            if (!job || !job.todos) return;
            
            const todo = job.todos.find(t => t.id === todoId);
            if (todo) {
                todo.done = !todo.done;
                await saveUserData();
                renderAll();
            }
        }
        
        async function deleteJobTodo(jobId, todoId) {
            const job = jobs.find(j => j.id === jobId);
            if (!job || !job.todos) return;
            
            if (confirm('Delete this to-do?')) {
                job.todos = job.todos.filter(t => t.id !== todoId);
                await saveUserData();
                renderAll();
            }
        }
        
        function addInterviewForJob(jobId) {
            openAddInterviewModal();
            // Populate the dropdown and select this job
            setTimeout(() => {
                document.getElementById('interviewJobId').value = jobId;
                const job = jobs.find(j => j.id === jobId);
                if (job) {
                    document.getElementById('interviewCompany').value = job.company;
                }
            }, 100);
        }
        
        function viewLinkedJob(jobId) {
            switchTab('pipeline');
            document.querySelectorAll('.tab')[0].classList.add('active');
            // Scroll to the job card
            setTimeout(() => {
                const jobCard = document.querySelector(`[data-job-id="${jobId}"]`);
                if (jobCard) {
                    jobCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    jobCard.style.border = '3px solid #667eea';
                    setTimeout(() => {
                        jobCard.style.border = '2px solid #e0e0e0';
                    }, 2000);
                }
            }, 100);
        }

        // Add todo
        async function addTodo(e) {
            e.preventDefault();
            const newTodo = {
                id: Date.now(),
                text: document.getElementById('todoText').value,
                urgent: document.getElementById('todoUrgent').checked,
                done: false
            };
            todos.unshift(newTodo);
            await saveUserData();
            renderAll();
            closeModal('addTodoModal');
            document.getElementById('addTodoForm').reset();
        }

        // Add target
        async function addTarget(e) {
            e.preventDefault();
            const newTarget = {
                id: Date.now(),
                company: document.getElementById('targetCompany').value,
                role: document.getElementById('targetRole').value,
                priority: document.getElementById('targetPriority').value,
                why: document.getElementById('targetWhy').value
            };
            targets.unshift(newTarget);
            await saveUserData();
            renderAll();
            closeModal('addTargetModal');
            document.getElementById('addTargetForm').reset();
        }

        // Delete functions
        async function deleteJob(id) {
            if (confirm('Are you sure you want to delete this application?')) {
                jobs = jobs.filter(j => j.id !== id);
                await saveUserData();
                renderAll();
            }
        }

        async function deleteInterview(id) {
            if (confirm('Are you sure you want to delete this interview?')) {
                interviews = interviews.filter(i => i.id !== id);
                await saveUserData();
                renderAll();
            }
        }

        async function deleteTodo(id) {
            todos = todos.filter(t => t.id !== id);
            await saveUserData();
            renderAll();
        }

        async function deleteTarget(id) {
            targets = targets.filter(t => t.id !== id);
            await saveUserData();
            renderAll();
        }

        // Toggle todo
        async function toggleTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (todo) {
                todo.done = !todo.done;
                await saveUserData();
                renderTodos();
            }
        }

        // Mark target as applied
        async function markApplied(id) {
            const target = targets.find(t => t.id === id);
            if (target && confirm(`Add ${target.company} - ${target.role} to your applications?`)) {
                const newJob = {
                    id: Date.now(),
                    company: target.company,
                    role: target.role,
                    status: 'applied',
                    date: new Date().toISOString().split('T')[0],
                    salary: 'Not specified',
                    location: 'Not specified',
                    notes: target.why
                };
                jobs.unshift(newJob);
                targets = targets.filter(t => t.id !== id);
                await saveUserData();
                renderAll();
                switchTab('pipeline');
                document.querySelectorAll('.tab')[0].classList.add('active');
            }
        }

        // Add prep material
        async function addPrep(e) {
            e.preventDefault();
            const driveLink = document.getElementById('prepDriveLink').value;
            const content = document.getElementById('prepContent').value;
            
            // Validate: must have either drive link or content
            if (!driveLink && !content) {
                alert('Please provide either a Google Drive link or quick notes (or both)');
                return;
            }
            
            const newPrep = {
                id: Date.now(),
                title: document.getElementById('prepTitle').value,
                type: document.getElementById('prepType').value,
                company: document.getElementById('prepCompany').value,
                driveLink: driveLink,
                content: content,
                date: new Date().toLocaleDateString()
            };
            prepMaterials.unshift(newPrep);
            await saveUserData();
            renderAll();
            closeModal('addPrepModal');
            document.getElementById('addPrepForm').reset();
        }

        // View prep material
        function viewPrep(id) {
            const prep = prepMaterials.find(p => p.id === id);
            if (prep) {
                document.getElementById('viewPrepTitle').textContent = prep.title;
                document.getElementById('viewPrepContent').value = prep.content;
                document.getElementById('viewPrepModal').classList.add('active');
            }
        }

        // Copy prep content from view modal
        function copyPrepContent() {
            const content = document.getElementById('viewPrepContent').value;
            navigator.clipboard.writeText(content).then(() => {
                alert('‚úÖ Copied to clipboard!');
            }).catch(() => {
                alert('‚ùå Failed to copy. Please select and copy manually.');
            });
        }

        // Copy prep content directly
        function copyPrepToClipboard(id) {
            const prep = prepMaterials.find(p => p.id === id);
            if (prep) {
                navigator.clipboard.writeText(prep.content).then(() => {
                    alert('‚úÖ Copied to clipboard!');
                }).catch(() => {
                    alert('‚ùå Failed to copy. Please try again.');
                });
            }
        }

        // Delete prep material
        async function deletePrep(id) {
            if (confirm('Are you sure you want to delete this prep material?')) {
                prepMaterials = prepMaterials.filter(p => p.id !== id);
                await saveUserData();
                renderAll();
            }
        }

        // Show metric details
        function showMetricDetails(metricType) {
            let title = '';
            let content = '';
            
            if (metricType === 'total') {
                title = 'üìä All Applications (' + jobs.length + ')';
                content = `
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <thead>
                            <tr style="background: #f8f9fa; border-bottom: 2px solid #667eea;">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Company</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Role</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Status</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Applied Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${jobs.map(job => `
                                <tr style="border-bottom: 1px solid #e0e0e0;">
                                    <td style="padding: 12px; font-weight: 600;">${job.company}</td>
                                    <td style="padding: 12px;">${job.role}</td>
                                    <td style="padding: 12px;">
                                        <span class="job-status status-${job.status}" style="display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 0.85em;">
                                            ${job.status.toUpperCase()}
                                        </span>
                                    </td>
                                    <td style="padding: 12px;">${job.date}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else if (metricType === 'active') {
                const activeJobs = jobs.filter(j => j.status !== 'rejected' && j.status !== 'offer');
                title = 'üéØ Active Pipeline (' + activeJobs.length + ')';
                content = `
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <thead>
                            <tr style="background: #f8f9fa; border-bottom: 2px solid #667eea;">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Company</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Role</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Status</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Applied Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${activeJobs.length === 0 ? '<tr><td colspan="4" style="padding: 20px; text-align: center; color: #999;">No active applications</td></tr>' : 
                                activeJobs.map(job => `
                                <tr style="border-bottom: 1px solid #e0e0e0;">
                                    <td style="padding: 12px; font-weight: 600;">${job.company}</td>
                                    <td style="padding: 12px;">${job.role}</td>
                                    <td style="padding: 12px;">
                                        <span class="job-status status-${job.status}" style="display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 0.85em;">
                                            ${job.status.toUpperCase()}
                                        </span>
                                    </td>
                                    <td style="padding: 12px;">${job.date}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else if (metricType === 'interviews') {
                title = 'üé§ All Interviews (' + interviews.length + ')';
                content = `
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <thead>
                            <tr style="background: #f8f9fa; border-bottom: 2px solid #667eea;">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Company</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Stage</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Date</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Outcome</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${interviews.length === 0 ? '<tr><td colspan="4" style="padding: 20px; text-align: center; color: #999;">No interviews yet</td></tr>' :
                                interviews.map(interview => `
                                <tr style="border-bottom: 1px solid #e0e0e0;">
                                    <td style="padding: 12px; font-weight: 600;">${interview.company}</td>
                                    <td style="padding: 12px;">${interview.stage}</td>
                                    <td style="padding: 12px;">${interview.date}</td>
                                    <td style="padding: 12px;">
                                        <span class="job-status ${interview.outcome === 'Passed' ? 'status-offer' : interview.outcome === 'Rejected' ? 'status-rejected' : 'status-waiting'}" style="display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 0.85em;">
                                            ${interview.outcome}
                                        </span>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
            
            document.getElementById('metricDetailsTitle').textContent = title;
            document.getElementById('metricDetailsContent').innerHTML = content;
            document.getElementById('metricDetailsModal').classList.add('active');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }
        
        // Export to CSV
        function exportToCSV() {
            try {
                const date = new Date().toISOString().split('T')[0];
                
                // Export Applications
                exportArrayToCSV(jobs, `applications-${date}.csv`, [
                    'company', 'role', 'status', 'date', 'salary', 'location', 'url', 'notes'
                ]);
                
                // Export Interviews
                const interviewsFlat = interviews.map(i => ({
                    company: i.company,
                    stage: i.stage,
                    interviewer: i.interviewer || '',
                    date: i.date || '',
                    duration: i.duration || '',
                    outcome: i.outcome,
                    questions: i.questions || '',
                    answers: i.answers || '',
                    yourQuestions: i.yourQuestions || '',
                    notes: i.notes || '',
                    followup: i.followup || ''
                }));
                exportArrayToCSV(interviewsFlat, `interviews-${date}.csv`, [
                    'company', 'stage', 'interviewer', 'date', 'duration', 'outcome', 
                    'questions', 'answers', 'yourQuestions', 'notes', 'followup'
                ]);
                
                // Export To-Dos
                exportArrayToCSV(todos, `todos-${date}.csv`, ['text', 'urgent', 'done']);
                
                // Export Targets
                exportArrayToCSV(targets, `targets-${date}.csv`, ['company', 'role', 'priority', 'why']);
                
                // Export Prep Materials
                const prepFlat = prepMaterials.map(p => ({
                    title: p.title,
                    type: p.type,
                    company: p.company || '',
                    driveLink: p.driveLink || '',
                    content: p.content || '',
                    date: p.date
                }));
                exportArrayToCSV(prepFlat, `prep-materials-${date}.csv`, [
                    'title', 'type', 'company', 'driveLink', 'content', 'date'
                ]);
                
                alert('‚úÖ Exported 5 CSV files! Check your Downloads folder.\n\nFiles exported:\n- applications\n- interviews\n- todos\n- targets\n- prep-materials');
            } catch (error) {
                console.error('Export error:', error);
                alert('‚ùå Error exporting data: ' + error.message);
            }
        }
        
        function exportArrayToCSV(array, filename, headers) {
            if (array.length === 0) {
                console.log(`Skipping ${filename} - no data`);
                return;
            }
            
            // Create CSV content
            const csvRows = [];
            csvRows.push(headers.join(','));
            
            array.forEach(item => {
                const values = headers.map(header => {
                    const value = item[header] || '';
                    // Escape quotes and wrap in quotes if contains comma or newline
                    const escaped = String(value).replace(/"/g, '""');
                    return escaped.includes(',') || escaped.includes('\n') ? `"${escaped}"` : escaped;
                });
                csvRows.push(values.join(','));
            });
            
            const csvContent = csvRows.join('\n');
            downloadFile(csvContent, filename, 'text/csv');
        }
        
        // Export Full Backup (JSON)
        function exportBackup() {
            try {
                const date = new Date().toISOString().split('T')[0];
                const backup = {
                    exportDate: new Date().toISOString(),
                    username: currentUsername,
                    version: '1.0',
                    data: {
                        jobs,
                        interviews,
                        todos,
                        targets,
                        prepMaterials
                    }
                };
                
                const json = JSON.stringify(backup, null, 2);
                downloadFile(json, `job-tracker-backup-${date}.json`, 'application/json');
                
                alert('‚úÖ Full backup exported!\n\nSave this file to Google Drive for safekeeping.');
            } catch (error) {
                console.error('Backup error:', error);
                alert('‚ùå Error creating backup: ' + error.message);
            }
        }
        
        // Import handler
        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    
                    if (file.name.endsWith('.json')) {
                        // Import JSON backup
                        importJSON(content);
                    } else if (file.name.endsWith('.csv')) {
                        // Import CSV
                        importCSV(content, file.name);
                    } else {
                        alert('‚ùå Unsupported file type. Please use CSV or JSON files.');
                    }
                } catch (error) {
                    console.error('Import error:', error);
                    alert('‚ùå Error importing file: ' + error.message);
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }
        
        function importJSON(content) {
            if (!confirm('‚ö†Ô∏è This will REPLACE all your current data with the backup. Continue?')) {
                return;
            }
            
            try {
                const backup = JSON.parse(content);
                
                if (!backup.data) {
                    alert('‚ùå Invalid backup file format.');
                    return;
                }
                
                jobs = backup.data.jobs || [];
                interviews = backup.data.interviews || [];
                todos = backup.data.todos || [];
                targets = backup.data.targets || [];
                prepMaterials = backup.data.prepMaterials || [];
                
                saveUserData();
                renderAll();
                
                alert('‚úÖ Data imported successfully from backup!');
            } catch (error) {
                alert('‚ùå Error importing JSON: ' + error.message);
            }
        }
        
        function importCSV(content, filename) {
            try {
                const lines = content.split('\n').filter(line => line.trim());
                if (lines.length < 2) {
                    alert('‚ùå CSV file appears to be empty.');
                    return;
                }
                
                const headers = lines[0].split(',').map(h => h.trim());
                const data = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const values = parseCSVLine(lines[i]);
                    const obj = {};
                    headers.forEach((header, index) => {
                        obj[header] = values[index] || '';
                    });
                    data.push(obj);
                }
                
                // Determine which type of data based on filename
                if (filename.includes('application')) {
                    if (confirm(`Import ${data.length} applications? This will REPLACE existing applications.`)) {
                        jobs = data.map(item => ({
                            id: Date.now() + Math.random(),
                            company: item.company,
                            role: item.role,
                            status: item.status || 'applied',
                            date: item.date,
                            salary: item.salary,
                            location: item.location,
                            url: item.url || '',
                            notes: item.notes || '',
                            todos: []
                        }));
                        saveUserData();
                        renderAll();
                        alert('‚úÖ Applications imported!');
                    }
                } else if (filename.includes('interview')) {
                    if (confirm(`Import ${data.length} interviews? This will REPLACE existing interviews.`)) {
                        interviews = data.map(item => ({
                            id: Date.now() + Math.random(),
                            jobId: null,
                            company: item.company,
                            stage: item.stage,
                            interviewer: item.interviewer || '',
                            date: item.date,
                            duration: item.duration || '',
                            outcome: item.outcome,
                            questions: item.questions || '',
                            answers: item.answers || '',
                            yourQuestions: item.yourQuestions || '',
                            notes: item.notes || '',
                            followup: item.followup || ''
                        }));
                        saveUserData();
                        renderAll();
                        alert('‚úÖ Interviews imported!');
                    }
                } else if (filename.includes('todo')) {
                    if (confirm(`Import ${data.length} to-dos? This will REPLACE existing to-dos.`)) {
                        todos = data.map(item => ({
                            id: Date.now() + Math.random(),
                            text: item.text,
                            urgent: item.urgent === 'true',
                            done: item.done === 'true'
                        }));
                        saveUserData();
                        renderAll();
                        alert('‚úÖ To-dos imported!');
                    }
                } else if (filename.includes('target')) {
                    if (confirm(`Import ${data.length} targets? This will REPLACE existing targets.`)) {
                        targets = data.map(item => ({
                            id: Date.now() + Math.random(),
                            company: item.company,
                            role: item.role,
                            priority: item.priority || 'MEDIUM',
                            why: item.why || ''
                        }));
                        saveUserData();
                        renderAll();
                        alert('‚úÖ Targets imported!');
                    }
                } else if (filename.includes('prep')) {
                    if (confirm(`Import ${data.length} prep materials? This will REPLACE existing prep materials.`)) {
                        prepMaterials = data.map(item => ({
                            id: Date.now() + Math.random(),
                            title: item.title,
                            type: item.type,
                            company: item.company || '',
                            driveLink: item.driveLink || '',
                            content: item.content || '',
                            date: item.date
                        }));
                        saveUserData();
                        renderAll();
                        alert('‚úÖ Prep materials imported!');
                    }
                } else {
                    alert('‚ùå Could not determine data type from filename. Please name files like:\napplications-*.csv\ninterviews-*.csv\ntodos-*.csv\ntargets-*.csv\nprep-materials-*.csv');
                }
            } catch (error) {
                alert('‚ùå Error importing CSV: ' + error.message);
            }
        
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    if (inQuotes && line[i + 1] === '"') {
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }
        
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Enter key to login
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('usernameInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    login();
                }
            });
            init();
        });
    </script>
</body>
</html>
